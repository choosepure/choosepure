<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Reports Page</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Debug Reports Page Issue</h1>
    
    <div>
        <button onclick="testDirectAPI()">Test Direct API</button>
        <button onclick="testWithAxios()">Test with Axios (like React app)</button>
        <button onclick="testReactAppURL()">Test React App URL</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function addResult(message, isSuccess = true, data = null) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            
            let content = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            if (data) {
                content += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            
            div.innerHTML = content;
            results.appendChild(div);
        }

        async function testDirectAPI() {
            try {
                addResult('Testing direct fetch to API...');
                
                const response = await fetch('http://localhost:8000/api/reports');
                const data = await response.json();
                
                addResult(`Direct API: ${data.success ? 'Success' : 'Failed'} - ${data.data.total} reports`, data.success, {
                    total: data.data.total,
                    firstReport: data.data.reports[0] ? {
                        id: data.data.reports[0].id,
                        productName: data.data.reports[0].productName,
                        brand: data.data.reports[0].brand
                    } : null
                });
                
            } catch (error) {
                addResult(`Direct API Error: ${error.message}`, false);
            }
        }

        async function testWithAxios() {
            try {
                addResult('Testing with Axios (simulating React app)...');
                
                // Create axios instance like the React app
                const api = axios.create({
                    baseURL: 'http://localhost:8000/api',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                const response = await api.get('/reports');
                const data = response.data;
                
                addResult(`Axios API: ${data.success ? 'Success' : 'Failed'} - ${data.data.total} reports`, data.success, {
                    status: response.status,
                    total: data.data.total,
                    reportsLength: data.data.reports.length
                });
                
            } catch (error) {
                addResult(`Axios Error: ${error.message}`, false, {
                    response: error.response ? {
                        status: error.response.status,
                        data: error.response.data
                    } : null
                });
            }
        }

        async function testReactAppURL() {
            try {
                addResult('Testing React app URL...');
                
                const response = await fetch('http://localhost:3000/reports');
                const text = await response.text();
                
                addResult(`React app response: ${response.status}`, response.ok, {
                    status: response.status,
                    contentType: response.headers.get('content-type'),
                    hasReactApp: text.includes('react'),
                    hasReportsPage: text.includes('reports') || text.includes('Reports')
                });
                
            } catch (error) {
                addResult(`React app error: ${error.message}`, false);
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Auto-test on page load
        window.addEventListener('load', function() {
            addResult('Debug page loaded. Testing API connectivity...');
            setTimeout(testDirectAPI, 1000);
        });
    </script>
</body>
</html>