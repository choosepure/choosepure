<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Admin Form</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .form-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            color: #333;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #059669;
        }
        .test-result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Debug Admin Form - Input Visibility Test</h1>
        
        <div class="debug-info" id="debugInfo">
            Form state will appear here...
        </div>

        <form id="testForm">
            <div class="form-group">
                <label for="product_name">Product Name *</label>
                <input 
                    type="text" 
                    id="product_name" 
                    name="product_name" 
                    placeholder="e.g., Amul Gold Milk"
                    required
                />
            </div>

            <div class="form-group">
                <label for="brand">Brand *</label>
                <input 
                    type="text" 
                    id="brand" 
                    name="brand" 
                    placeholder="e.g., Amul"
                    required
                />
            </div>

            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" name="category" required>
                    <option value="Dairy">Dairy</option>
                    <option value="Sweeteners">Sweeteners</option>
                    <option value="Oils">Oils</option>
                    <option value="Spices">Spices</option>
                </select>
            </div>

            <div class="form-group">
                <label for="purity_score">Purity Score (0-10) *</label>
                <input 
                    type="number" 
                    id="purity_score" 
                    name="purity_score" 
                    step="0.1" 
                    min="0" 
                    max="10" 
                    value="9.0"
                    required
                />
            </div>

            <div class="form-group">
                <label for="test_date">Test Date *</label>
                <input 
                    type="date" 
                    id="test_date" 
                    name="test_date" 
                    required
                />
            </div>

            <div class="form-group">
                <label for="image">Image URL *</label>
                <input 
                    type="url" 
                    id="image" 
                    name="image" 
                    placeholder="https://images.unsplash.com/photo-..."
                    required
                />
            </div>

            <div class="form-group">
                <label for="summary">Summary *</label>
                <textarea 
                    id="summary" 
                    name="summary" 
                    rows="3" 
                    placeholder="Brief summary of test results..."
                    required
                ></textarea>
            </div>

            <button type="button" onclick="testAPI()">Test API Call</button>
            <button type="button" onclick="clearForm()">Clear Form</button>
        </form>

        <div id="testResult"></div>
    </div>

    <script>
        const formData = {
            product_name: '',
            brand: '',
            category: 'Dairy',
            purity_score: 9.0,
            test_date: new Date().toISOString().split('T')[0],
            image: '',
            summary: ''
        };

        function updateDebugInfo() {
            document.getElementById('debugInfo').innerHTML = 
                '<strong>Current Form State:</strong><br>' + 
                JSON.stringify(formData, null, 2);
        }

        function handleInputChange(e) {
            const { name, value } = e.target;
            formData[name] = value;
            updateDebugInfo();
            console.log('Input changed:', name, '=', value);
        }

        // Add event listeners to all form inputs
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', handleInputChange);
                input.addEventListener('change', handleInputChange);
            });
            
            // Set initial date
            document.getElementById('test_date').value = formData.test_date;
            updateDebugInfo();
        });

        async function testAPI() {
            const resultDiv = document.getElementById('testResult');
            
            try {
                // First login
                const loginResponse = await fetch('http://localhost:8000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@choosepure.in',
                        password: 'admin123'
                    })
                });
                
                const loginData = await loginResponse.json();
                
                if (!loginData.success) {
                    throw new Error('Login failed: ' + (loginData.detail || 'Unknown error'));
                }
                
                // Create test report
                const reportResponse = await fetch('http://localhost:8000/api/reports', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${loginData.token}`
                    },
                    body: JSON.stringify({
                        ...formData,
                        parameters: [
                            { name: 'Fat Content', result: '3.5%', status: 'pass' },
                            { name: 'Protein', result: '3.2%', status: 'pass' }
                        ]
                    })
                });
                
                const reportData = await reportResponse.json();
                
                if (reportData.success) {
                    resultDiv.innerHTML = `<div class="test-result success">
                        <strong>Success!</strong> Report created with ID: ${reportData.data.id}
                        <br>Product: ${reportData.data.productName}
                    </div>`;
                } else {
                    throw new Error('Report creation failed: ' + (reportData.detail || 'Unknown error'));
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    <strong>Error:</strong> ${error.message}
                </div>`;
            }
        }

        function clearForm() {
            document.getElementById('testForm').reset();
            Object.keys(formData).forEach(key => {
                if (key === 'category') formData[key] = 'Dairy';
                else if (key === 'purity_score') formData[key] = 9.0;
                else if (key === 'test_date') formData[key] = new Date().toISOString().split('T')[0];
                else formData[key] = '';
            });
            updateDebugInfo();
        }
    </script>
</body>
</html>