<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Panel API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Admin Panel API Test</h1>
    
    <div>
        <h2>Test Report Operations</h2>
        <button onclick="testGetReports()">Get All Reports</button>
        <button onclick="testCreateReport()">Create Test Report</button>
        <button onclick="testLogin()">Login as Admin</button>
    </div>
    
    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        let authToken = '';

        function addResult(message, isSuccess = true) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
        }

        async function testLogin() {
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@choosepure.in',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    authToken = data.token;
                    addResult(`Login successful! User: ${data.user.name} (${data.user.role})`);
                } else {
                    addResult(`Login failed: ${data.detail || 'Unknown error'}`, false);
                }
            } catch (error) {
                addResult(`Login error: ${error.message}`, false);
            }
        }

        async function testGetReports() {
            try {
                const response = await fetch(`${API_BASE}/reports`);
                const data = await response.json();
                
                if (data.success) {
                    addResult(`Found ${data.data.total} reports: ${JSON.stringify(data.data.reports.map(r => r.productName))}`);
                } else {
                    addResult(`Failed to get reports: ${data.message}`, false);
                }
            } catch (error) {
                addResult(`Get reports error: ${error.message}`, false);
            }
        }

        async function testCreateReport() {
            if (!authToken) {
                addResult('Please login first!', false);
                return;
            }

            try {
                const reportData = {
                    product_name: 'Test Report from Browser',
                    brand: 'Test Brand',
                    category: 'Dairy',
                    purity_score: 8.8,
                    test_date: '2024-01-22',
                    tested_by: 'NABL Certified Lab',
                    image: 'https://images.unsplash.com/photo-1550583724-b2692b85b150',
                    parameters: [
                        { name: 'Fat Content', result: '3.8%', status: 'pass' },
                        { name: 'Protein', result: '3.3%', status: 'pass' }
                    ],
                    summary: 'Test report created from browser test'
                };

                const response = await fetch(`${API_BASE}/reports`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(reportData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addResult(`Report created successfully! ID: ${data.data.id}, Product: ${data.data.productName}`);
                } else {
                    addResult(`Failed to create report: ${data.detail || 'Unknown error'}`, false);
                }
            } catch (error) {
                addResult(`Create report error: ${error.message}`, false);
            }
        }
    </script>
</body>
</html>